# SOAP
Before REST, SOAP (Simple Object Access Protocol) services were the most popular kind of web service. Unlike REST it defines a protocol for XML based communication across multiple transport protocols (HTTP, SMTP, FTP, etc). This protocol is uniquely defined for each SOAP service by its WSDL (Web Service Definition Language) XML file. But like REST which is mostly HTTP and JSON based, SOAP is largely platform independent being purely XML based. The SOAP message is delivered in an XML envelope carried in the body of a transport protocol like an HTTP POST.

## WSDL
The Web Service Description Language (WSDL) is an XML document describing everything about a SOAP service. It can be accessed on the endpoint of an exposed SOAP service with the `?wsdl` query string. The WSDL can be thought of as an interface or contract for the whole service, which is either generated by a preconfigured WSDL file (**contract-first**) or generates a WSDL from its source code (**contract-last**). Important element tags include:
* **definition** - the root element
* **types** - any complex datatype used in document (not necessary if only simple types)
* **message** - define data elements for each operation (method params, return values)
* **porttype** - defines operations that can be performed and the messages involved
    * **operation** - abstract description of action supported by service
* **binding** - specify protocol and data format for operations and messages
* **service** - specify port address(es) of binding
    * **port** - specify single endpoint as address for binding
    
### JAX-WS
Java API for XML Web Services (JAX-WS) is Java's standard library of annotations and classes that can expose a SOAP service. It has standard implementations for annotations like `@WebService`, `@WebMethod`, and `@WebParam` among others, as well as the `Endpoint.publish()` method that will host an annotated service and generate the WSDL. It will use JAX-B to marshall Java objects into XML format and unmarshall them as well. Other frameworks such as `Apache CXF` implement and extend JAX-WS for more complex web services.

### Soap Binding styles
When translating the WSDL binding element to a SOAP message, there are di
* Model: Literal (DOCUMENT) vs Encoded (RPC)
* DOCUMENT you define XML structure of message body (message-oriented)
    * Literal: contents conform to user-defined xsd
* RPC  request body must contain operation name and method parameters
    * Encoded: uses xsd datatypes but body doesn't need to conform to user-defined xsd

### SOAP Message
A SOAP message is defined by the WSDL and carried inside an XML document called an envelope.
* Envelope  (mandatory), defines start/end of message
* Header  (optional), optional attributes to be used when processing message
* Body  (mandatory), XML data with message to be sent (only one allowed)
* Fault  (optional), describes errors that may have occurred when processing

#### Message Structure
```xml
<xml version=1.0?>
<soap-env:Envelope xmlns=soap-env=www.w3.org/2001/12/soap-envelope soap-env:encodingStyle=www.w3.org/2001/12/soap-encoding>
    <soap-env:Header>
    </soal-env:Header>
    <soap-env:Body>
        <soap-env:Fault>
        </soap-env:Fault>
    </soap-env:Body>
</soap-env:Envelope>
```

To generate a SOAP message and envelope, use the JDK's `wsimport` tool to create Java class files to communicate directly with the service, or use a tool like [Wizdler](https://chrome.google.com/webstore/detail/wizdler/oebpmncolmhiapingjaagmapififiakb).

#### Faults
Fault blocks carry error messages of failed SOAP requests. Only one fault block is allowed per message. They are optional and generally include an HttpBinding success code (Success: 200-299). Elements include:
* `<faultCode>`
* `<soap-env:versionMismatch>` - invalid namespace for env
* `<soap-env:mustUnderstand>` - immediate child of header element not understood
* `<soap-env:client>` - message was incorrectly formed
* `<soap-env:Server>` - error with server
* `<faultString>`
* `<details>`